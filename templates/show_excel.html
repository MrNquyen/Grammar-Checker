<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Sheet</title>

    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <!-- <style>
        .tab-btn:hover {
            background-color: #ddd !important;
        }
        .tab-btn.active {
            background-color: #ccc !important;
            border-bottom: 2px solid #000 !important;
        }
        .tab-pane {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
        }
        .tab-pane.active {
            display: block;
        }
    </style> -->

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/show_excel.js') }}" type="text/javascript"></script>
</head>

<body>
    <!-- Header with sheet selector -->
    <header style="height: 15vh;">
        <h2 id="current-sheet-title">Showing sheet:</h2>

        <div class="toolbar">
            <form id="sheetForm" action="/show_sheet" method="get">
                <select name="sheet" id="sheet-select">
                    {% for sheet in sheets %}
                        <option value="{{ sheet }}">{{ sheet }}</option>
                    {% endfor %}
                </select>
                <button type="submit">Show Sheet</button>
            </form>
        </div>

        <form id="export-corrections-form" action="/export_correction" method="post">
            <input type="submit" value="Export correction">
        </form>

        <form id="check-sheet-grammar">
            <input type="submit" value="Check Grammar">
        </form>
                
        <form action="{{ url_for('index') }}" method="get">
            <input type="submit" value="Go To Home Page">
        </form>    
    </header>

    <!-- Spinner -->
    <div id="loading-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; text-align:center;">
        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);">
            <div class="spinner"></div>
            <p>Pending ...</p>
        </div>
    </div>

    <!-- Content -->
    <main class="content-container">
        <section id="ss" style="width: 100%; height: 80vh;">
            {{ iframe | safe }}
        </section>

        <!-- Error panel -->
        <aside id="error-panel">
            <div class="tab">
                <button class="tab-btn active" onclick="openTab(event, 'found-spelling')">Error List</button>
                <button class="tab-btn" onclick="openTab(event, 'rejected')">Rejected</button>
            </div>
            <div class="tab-content">
                <div id="found-spelling" class="tab-pane active">
                    <ul id="error-list">
                    <li>Error 1</li>
                    <li>Error 2</li>
                    </ul>
                </div>
                <div id="rejected" class="tab-pane">
                    <ul id="rejected-list">
                    <li>Reject 1</li>
                    <li>Reject 2</li>
                    </ul>
                </div>
            </div>
        </aside>
    </main>

    <script>
        const sheetSelect = document.getElementById("sheet-select");

        // Backend data
        const currentSheetName = "{{ current_sheet_name | default('') }}";
        const correctionResults = {{ correction_results | default([]) | tojson | safe }};


        // Swith tab between reject and allow
        // document.querySelectorAll(".tab-btn").forEach(btn => {
        //     btn.addEventListener("click", () => {
        //         const targetTab = btn.getAttribute("data-tab");

        //         // Deactive all button
        //         document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        //         btn.classList.add("active");

        //         // Hide all tab
        //         document.querySelectorAll(".tab-pane").forEach(tab => tab.classList.remove("active"));

        //         // Show selected tab
        //         document.getElementById(targetTab).classList.add("active");
        //     });
        // });
        
        function openTab(evt, tabName) {
            // Hide all tab content
            const tabcontent = document.querySelectorAll('.tab-pane');
            tabcontent.forEach(content => content.classList.remove('active'));

            // Remove "active" class from all buttons
            const tabbuttons = document.querySelectorAll('.tab-btn');
            tabbuttons.forEach(link => link.classList.remove('active'));

            // Show the current tab and add "active" class to the clicked button
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // Update error list
        console.log("Correction Report when show sheet", correctionResults)
        updateGrammarPanel(correctionResults);
        
        console.log("Iframe:", "{{ iframe }}");
        
        // Export Report Correction
        exportCorrections()

        // Set current sheet in selector
        if (currentSheetName) {
            sheetSelect.value = currentSheetName;
            requestCheckSheetGrammar("check-sheet-grammar", currentSheetName);
        } else if (sheetSelect.options.length > 0) {
            sheetSelect.value = sheetSelect.options[0].value;
        }
    </script>
</body>
</html>
